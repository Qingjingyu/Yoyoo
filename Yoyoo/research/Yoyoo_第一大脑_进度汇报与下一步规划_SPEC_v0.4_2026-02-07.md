# Yoyoo 第一大脑：进度汇报与下一步规划 SPEC v0.4（2026-02-07）

## 1. 当前总体状态
- 核心链路已稳定运行：`钉钉 -> Yoyoo Backend(8000) -> Yoyoo Brain -> OpenClaw Adapter`。
- 旧并行链路（`18000`）已从用户级服务停用，避免串线和状态覆盖。
- 反馈闭环已可用：在钉钉直接发“这次很好/不好”可自动绑定最近任务并写入记忆。

## 2. 已完成能力（截至本版本）
- P3-A 执行质量治理：执行质量评分、问题标记、低质量纠偏重试。
- P3-B 学习升级：策略卡生成与复用，反馈信号参与学习统计。
- P3-C 规划升级：模板化任务拆解、先只读后写、证据采集与回滚模板。
- P4 反馈闭环：支持 task_id 提示、同会话/同用户/同渠道多层回退绑定。
- 运营可观测性增强：
  - 新增 `feedback_binding_audit` 结构化日志（source/task_id/failure_reason）。
  - 任务回包固定反馈引导文案（直接回复“好/不好”）。
  - 启动自检：检测 `:18000` 旧端口与重复 forwarder 并告警。

## 3. 验证状态
- 本地测试：`59 passed`。
- 服务器测试：`59 passed`。
- 服务器 lint：`ruff check .` 全量通过。
- 服务健康：`/healthz` 返回 `{"status":"ok","service":"yoyoo-backend"}`。

## 4. 仍需关注的风险
- 持久化一致性需继续观察（重点看 memory 文件是否被异常进程覆盖）。
- 对“新任务尚未落账就收到反馈”的极端时序，建议增加短时间窗口重试绑定。

## 5. 下一阶段开发规划（v0.5）
- P5-A 反馈绑定增强：
  - 支持“回复引用消息”优先绑定，减少误绑最近任务。
  - 增加 3~5 秒短窗口重试，覆盖高并发下的先反馈后落账。
- P5-B 记忆可靠性：
  - 引入原子写入与备份轮转（`memory.json.tmp -> rename`）。
  - 启动时执行一致性检查与自动修复策略（可回滚）。
- P5-C 可观测性与运维：
  - 增加 `/api/v1/ops/health`（任务台账、forwarder、策略卡、内存状态汇总）。
  - 增加最小化告警规则（重复进程、落盘失败、反馈绑失败率阈值）。
- P5-D 对话体验：
  - 任务回复末尾统一附“反馈按钮语义提示”。
  - 补充“我为什么绑定到这个任务”的可解释文本（可开关）。

## 6. 验收门槛（进入 v0.5）
- 回归测试持续通过，且新增场景覆盖：
  - 反馈早到/晚到、引用反馈、跨会话反馈、重启后反馈。
- 线上连续 24 小时无串线、无双进程、无反馈绑定异常高峰。
