# Yoyoo 第一大脑规划 SPEC v0.4

> 更新时间：2026-02-06（晚间）
> 目标：让 Yoyoo 成为“自主决策 + 持续学习 + 多执行器编排”的主系统，OpenClaw 作为可插拔执行能力。

## 1. 当前状态（已完成）

### 1.1 入口与编排
- 钉钉入口已切到 `DingTalk -> Yoyoo -> OpenClaw`。
- Yoyoo 已具备统一编排链路：意图识别、策略防护、任务规划、执行器调用、结果回写。

### 1.2 任务台账与可观测
- 每次任务生成 `task_id`，支持 `planned -> completed/failed` 状态流转。
- 全链路 `trace_id` 已打通（chat/dingtalk/brain/openclaw）。
- 已提供查询接口：
  - `GET /api/v1/tasks/{conversation_id}`
  - `GET /api/v1/traces/{trace_id}`

### 1.3 记忆与学习
- 三层记忆已落地：事实层、会话摘要、每日事件。
- 增加相关性召回：按 summary/task/event 混排评分。
- 学习闭环 v2：任务结果按 `user + channel + project` 分层统计。
- 学习建议可自动注入执行步骤（例如“优先复用稳定路径”“先健康检查”）。

### 1.4 执行可靠性
- OpenClaw 适配器支持多级降级：HTTP -> 本地执行 -> SSH。
- 本地执行前健康探测，异常时自动恢复探测。
- SSH 超时自动重试一次。
- 重试矩阵支持外部 JSON 配置 + 热更新（无需重启可生效）。

### 1.5 本轮新增（v0.4）
- 学习作用域升级：`user + channel + project`，同一用户同项目优先继承经验，跨用户默认隔离。
- 任务记录增加 `channel/project_key`，便于按项目复盘。
- `继续/按之前/再次` 等表达稳定识别为任务请求，避免掉入普通闲聊路由。

## 2. 当前风险与短板
- 执行器返回质量不稳定（有时偏闲聊，不够“可执行”）。
- 浏览器/CDP链路未彻底恢复，Web任务成功率受限。
- 学习策略仍以规则为主，缺少“任务模板化复用”与“质量反馈打分”。

## 3. 下一阶段计划（P3）

### P3-A（高优先）执行质量治理
- 引入执行结果评分（可执行性、完整性、可验证性）。
- 对“闲聊式执行反馈”进行自动降权与二次执行纠偏。
- 目标：任务回包可执行率持续提升。

### P3-B（高优先）学习升级
- 引入“策略卡（Strategy Card）”对象：触发条件、推荐步骤、禁忌项。
- 学习来源扩展到验收结果（通过/失败）与人工反馈（好/不好）。
- 目标：相似任务首轮可执行率明显提升。

### P3-C（中优先）规划质量提升
- 任务拆解模板化（部署、修复、数据处理、前端发布等）。
- 自动插入证据采集步骤（日志、命令输出、健康检查快照）。
- 对高风险任务默认启用“先只读探测，再写操作”。

## 4. 验收指标（建议）
- Task 首轮成功率（无人工补充）
- Task 平均重试次数
- 超时任务占比
- 学习命中率（是否命中历史策略）
- 钉钉端平均响应时延

## 5. 设计原则（持续约束）
- Yoyoo 负责决策与记忆，执行器负责动作。
- 学习必须可追溯（trace_id/task_id 可回放）。
- 所有自动化策略都要可回滚、可禁用、可审计。
