# Yoyoo 沙箱执行规范 v0.1（Linux）

## 1. 目的与范围
- 目的：让 Yoyoo 在“可控、安全、稳定”的前提下执行任务，避免 CEO 节点被长任务拖死。
- 范围：Ubuntu 服务器上的 Yoyoo 执行层（OpenClaw/Nano/后续执行器均适用）。
- 不含：飞书/钉钉产品设计细节、模型能力评测细节。

## 2. 核心原则
1. 脑手分离：CEO 只负责接单、分派、验收、汇报，不做长执行。
2. 一任务一沙箱：每个任务在独立运行环境执行，任务结束即销毁。
3. 最小权限：默认无权限，按任务临时放开。
4. 默认可回退：超时、失败必须给回执，不允许静默。
5. 可审计：所有执行有日志、有证据、有任务号。

## 3. 目标架构（最小可用）
`用户 -> Yoyoo CEO -> 调度器 -> 执行沙箱(Worker) -> 结果回传 -> CEO验收/存档`

- CEO：会话管理、任务拆解、质量验收、对外回复。
- 调度器：分配任务到 Worker，跟踪状态（queued/running/succeeded/failed/timeout）。
- Worker：执行命令与工具调用，只拿到最小挂载目录和最小网络权限。
- 记忆层：CEO 总记忆（长期）；Worker 局部记忆（短期，可丢弃）。

## 4. 安全控制基线
- 文件系统：
  - 默认只读根文件系统。
  - 仅挂载任务目录（如 `/workspace/tasks/<task_id>`）。
  - 禁止挂载密钥目录、历史全量目录。
- 网络：
  - 默认出网关闭。
  - 白名单放行（如模型 API、必要内部服务）。
- 进程：
  - 限制 CPU/内存/执行时长。
  - 超时自动中断并回收资源。
- 输出：
  - 单任务输出大小上限（防日志爆炸）。
  - 敏感信息脱敏后再回传。

## 5. 执行状态机（必须实现）
`queued -> running -> succeeded | failed | timeout | canceled`

- 每次状态变更都写入任务日志：`task_id`、时间、执行器、摘要。
- `timeout/failed` 必须触发 CEO 回执模板：
  - 当前进度
  - 失败原因（可读）
  - 下一步建议（重试/降级/人工确认）

## 6. 反卡死与自愈
- 会话防阻塞：
  - CEO 主会话禁止直接跑长命令。
  - 长任务必须异步下发到 Worker。
- 任务看门狗：
  - 心跳丢失自动标记异常并重试一次。
  - 重试仍失败则升级到人工处理。
- 锁与残留清理：
  - 启动时清理过期锁文件。
  - 定时清理僵尸进程与过期临时目录。

## 7. v0.1 验收标准
- 可用性：
  - 连续 20 条混合任务（短/中/长）无静默丢回复。
  - CEO 在长任务期间仍可正常接收新指令并回执。
- 稳定性：
  - 单任务超时后 30 秒内给出失败回执。
  - 服务重启后任务状态可恢复或可追溯。
- 安全性：
  - 未授权目录不可读写。
  - 未授权外网不可访问。

## 8. 落地顺序（建议）
1. 先做状态机与回执兜底（立刻止血）。
2. 再做 Worker 沙箱和最小权限挂载。
3. 最后做审计报表与自动自愈策略。

---

本规范对应当前 Yoyoo 阶段目标：先把“稳定交付”做实，再逐步开启“自主迭代”。
